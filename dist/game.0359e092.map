{"version":3,"sources":["node_modules\\babylonjs-gifexporter\\dist\\js\\gif.exporter.js","game.js"],"names":["__awaiter","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","value","step","next","e","rejected","result","done","then","apply","__generator","body","_","label","sent","t","trys","ops","f","y","g","verb","Symbol","iterator","n","v","op","TypeError","call","pop","length","push","factory","module","exports","require","undefined","define","amd","Object","defineProperty","GIFExporter","engine","options","_canvas","getRenderingCanvas","_delay","delay","_duration","duration","prototype","start","_this","intervalRef","_a","init","console","log","setInterval","frame","newFrame","message","getFrame","flipAndRotate","Uint8Array","job","params","_worker","postMessage","setTimeout","clearInterval","width","_resizeCanvas","height","onmessage","data","stop","cancel","download","filename","gif","url","URL","createObjectURL","Blob","type","document","createElement","appendChild","target","style","display","href","click","remove","terminate","gl","getContext","pixels","drawingBufferWidth","drawingBufferHeight","readPixels","RGBA","UNSIGNED_BYTE","buffer","_width","_height","Worker","canvasSetup","_holdingCanvas","_holdingCanvas2D","_resizeCanvas2D","imageData","createImageData","set","putImageData","resize","flip","getImageData","canvas","rejct","baseSize","imageAspectRatio","Math","max","resizeContext","holdingCanvas","resizeCanvas","globalCompositeOperation","scale","translate","drawImage","setTransform","default","captureBtn","getElementById","BabylonViewer","viewerManager","onViewerAddedObservable","add","viewer","onEngineInitObservable","recorder","addEventListener","disabled"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACAA;;;;;;AAEA,IAAM8I,aAAahD,SAASiD,cAAT,CAAwB,YAAxB,CAAnB;;AAEAC,cAAcC,aAAd,CAA4BC,uBAA5B,CAAoDC,GAApD,CAAwD,UAAUC,MAAV,EAAkB;;AAEtEA,WAAOC,sBAAP,CAA8BF,GAA9B,CAAkC,UAAUjG,MAAV,EAAkB;;AAEhD,YAAMoG,WAAW,IAAIrG,8BAAJ,CAAgBC,MAAhB,EAAwB;AACrCK,mBAAO,EAD8B;AAErCE,sBAAU;AAF2B,SAAxB,CAAjB;;AAKAqF,mBAAWS,gBAAX,CAA4B,OAA5B,EAAqC,YAAY;AAC7CT,uBAAWU,QAAX,GAAsB,IAAtB;AACAF,qBAAShE,QAAT,CAAkB,eAAlB;AACAwD,uBAAWU,QAAX,GAAsB,KAAtB;AAEH,SALD;AAMH,KAbD;AAeH,CAjBD;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ADJA,IAAIxJ,YAAa,QAAQ,KAAKA,SAAd,IAA4B,UAAUC,OAAV,EAAmBC,UAAnB,EAA+BC,CAA/B,EAAkCC,SAAlC,EAA6C;AACrF,WAAO,KAAKD,MAAMA,IAAIE,OAAV,CAAL,EAAyB,UAAUC,OAAV,EAAmBC,MAAnB,EAA2B;AACvD,iBAASC,SAAT,CAAmBC,KAAnB,EAA0B;AAAE,gBAAI;AAAEC,qBAAKN,UAAUO,IAAV,CAAeF,KAAf,CAAL;AAA8B,aAApC,CAAqC,OAAOG,CAAP,EAAU;AAAEL,uBAAOK,CAAP;AAAY;AAAE;AAC3F,iBAASC,QAAT,CAAkBJ,KAAlB,EAAyB;AAAE,gBAAI;AAAEC,qBAAKN,UAAU,OAAV,EAAmBK,KAAnB,CAAL;AAAkC,aAAxC,CAAyC,OAAOG,CAAP,EAAU;AAAEL,uBAAOK,CAAP;AAAY;AAAE;AAC9F,iBAASF,IAAT,CAAcI,MAAd,EAAsB;AAAEA,mBAAOC,IAAP,GAAcT,QAAQQ,OAAOL,KAAf,CAAd,GAAsC,IAAIN,CAAJ,CAAM,UAAUG,OAAV,EAAmB;AAAEA,wBAAQQ,OAAOL,KAAf;AAAwB,aAAnD,EAAqDO,IAArD,CAA0DR,SAA1D,EAAqEK,QAArE,CAAtC;AAAuH;AAC/IH,aAAK,CAACN,YAAYA,UAAUa,KAAV,CAAgBhB,OAAhB,EAAyBC,cAAc,EAAvC,CAAb,EAAyDS,IAAzD,EAAL;AACH,KALM,CAAP;AAMH,CAPD;AAQA,IAAIO,cAAe,QAAQ,KAAKA,WAAd,IAA8B,UAAUjB,OAAV,EAAmBkB,IAAnB,EAAyB;AACrE,QAAIC,IAAI,EAAEC,OAAO,CAAT,EAAYC,MAAM,YAAW;AAAE,gBAAIC,EAAE,CAAF,IAAO,CAAX,EAAc,MAAMA,EAAE,CAAF,CAAN,CAAY,OAAOA,EAAE,CAAF,CAAP;AAAc,SAAvE,EAAyEC,MAAM,EAA/E,EAAmFC,KAAK,EAAxF,EAAR;AAAA,QAAsGC,CAAtG;AAAA,QAAyGC,CAAzG;AAAA,QAA4GJ,CAA5G;AAAA,QAA+GK,CAA/G;AACA,WAAOA,IAAI,EAAEjB,MAAMkB,KAAK,CAAL,CAAR,EAAiB,SAASA,KAAK,CAAL,CAA1B,EAAmC,UAAUA,KAAK,CAAL,CAA7C,EAAJ,EAA4D,OAAOC,MAAP,KAAkB,UAAlB,KAAiCF,EAAEE,OAAOC,QAAT,IAAqB,YAAW;AAAE,eAAO,IAAP;AAAc,KAAjF,CAA5D,EAAgJH,CAAvJ;AACA,aAASC,IAAT,CAAcG,CAAd,EAAiB;AAAE,eAAO,UAAUC,CAAV,EAAa;AAAE,mBAAOvB,KAAK,CAACsB,CAAD,EAAIC,CAAJ,CAAL,CAAP;AAAsB,SAA5C;AAA+C;AAClE,aAASvB,IAAT,CAAcwB,EAAd,EAAkB;AACd,YAAIR,CAAJ,EAAO,MAAM,IAAIS,SAAJ,CAAc,iCAAd,CAAN;AACP,eAAOf,CAAP,EAAU,IAAI;AACV,gBAAIM,IAAI,CAAJ,EAAOC,MAAMJ,IAAII,EAAEO,GAAG,CAAH,IAAQ,CAAR,GAAY,QAAZ,GAAuBA,GAAG,CAAH,IAAQ,OAAR,GAAkB,MAA3C,CAAV,KAAiE,CAAC,CAACX,IAAIA,EAAEa,IAAF,CAAOT,CAAP,EAAUO,GAAG,CAAH,CAAV,CAAL,EAAuBnB,IAApG,EAA0G,OAAOQ,CAAP;AAC1G,gBAAII,IAAI,CAAJ,EAAOJ,CAAX,EAAcW,KAAK,CAAC,CAAD,EAAIX,EAAEd,KAAN,CAAL;AACd,oBAAQyB,GAAG,CAAH,CAAR;AACI,qBAAK,CAAL,CAAQ,KAAK,CAAL;AAAQX,wBAAIW,EAAJ,CAAQ;AACxB,qBAAK,CAAL;AAAQd,sBAAEC,KAAF,GAAW,OAAO,EAAEZ,OAAOyB,GAAG,CAAH,CAAT,EAAgBnB,MAAM,KAAtB,EAAP;AACnB,qBAAK,CAAL;AAAQK,sBAAEC,KAAF,GAAWM,IAAIO,GAAG,CAAH,CAAJ,CAAWA,KAAK,CAAC,CAAD,CAAL,CAAU;AACxC,qBAAK,CAAL;AAAQA,yBAAKd,EAAEK,GAAF,CAAMY,GAAN,EAAL,CAAkBjB,EAAEI,IAAF,CAAOa,GAAP,GAAc;AACxC;AACI,wBAAI,EAAEd,IAAIH,EAAEI,IAAN,EAAYD,IAAIA,EAAEe,MAAF,GAAW,CAAX,IAAgBf,EAAEA,EAAEe,MAAF,GAAW,CAAb,CAAlC,MAAuDJ,GAAG,CAAH,MAAU,CAAV,IAAeA,GAAG,CAAH,MAAU,CAAhF,CAAJ,EAAwF;AAAEd,4BAAI,CAAJ,CAAO;AAAW;AAC5G,wBAAIc,GAAG,CAAH,MAAU,CAAV,KAAgB,CAACX,CAAD,IAAOW,GAAG,CAAH,IAAQX,EAAE,CAAF,CAAR,IAAgBW,GAAG,CAAH,IAAQX,EAAE,CAAF,CAA/C,CAAJ,EAA2D;AAAEH,0BAAEC,KAAF,GAAUa,GAAG,CAAH,CAAV,CAAiB;AAAQ;AACtF,wBAAIA,GAAG,CAAH,MAAU,CAAV,IAAed,EAAEC,KAAF,GAAUE,EAAE,CAAF,CAA7B,EAAmC;AAAEH,0BAAEC,KAAF,GAAUE,EAAE,CAAF,CAAV,CAAgBA,IAAIW,EAAJ,CAAQ;AAAQ;AACrE,wBAAIX,KAAKH,EAAEC,KAAF,GAAUE,EAAE,CAAF,CAAnB,EAAyB;AAAEH,0BAAEC,KAAF,GAAUE,EAAE,CAAF,CAAV,CAAgBH,EAAEK,GAAF,CAAMc,IAAN,CAAWL,EAAX,EAAgB;AAAQ;AACnE,wBAAIX,EAAE,CAAF,CAAJ,EAAUH,EAAEK,GAAF,CAAMY,GAAN;AACVjB,sBAAEI,IAAF,CAAOa,GAAP,GAAc;AAXtB;AAaAH,iBAAKf,KAAKiB,IAAL,CAAUnC,OAAV,EAAmBmB,CAAnB,CAAL;AACH,SAjBS,CAiBR,OAAOR,CAAP,EAAU;AAAEsB,iBAAK,CAAC,CAAD,EAAItB,CAAJ,CAAL,CAAae,IAAI,CAAJ;AAAQ,SAjBzB,SAiBkC;AAAED,gBAAIH,IAAI,CAAR;AAAY;AAC1D,YAAIW,GAAG,CAAH,IAAQ,CAAZ,EAAe,MAAMA,GAAG,CAAH,CAAN,CAAa,OAAO,EAAEzB,OAAOyB,GAAG,CAAH,IAAQA,GAAG,CAAH,CAAR,GAAgB,KAAK,CAA9B,EAAiCnB,MAAM,IAAvC,EAAP;AAC/B;AACJ,CA1BD;AA2BA,CAAC,UAAUyB,OAAV,EAAmB;AAChB,QAAI,OAAOC,MAAP,KAAkB,QAAlB,IAA8B,OAAOA,OAAOC,OAAd,KAA0B,QAA5D,EAAsE;AAClE,YAAIT,IAAIO,QAAQG,OAAR,EAAiBD,OAAjB,CAAR;AACA,YAAIT,MAAMW,SAAV,EAAqBH,OAAOC,OAAP,GAAiBT,CAAjB;AACxB,KAHD,MAIK,IAAI,OAAOY,MAAP,KAAkB,UAAlB,IAAgCA,OAAOC,GAA3C,EAAgD;AACjDD,eAAO,CAAC,SAAD,EAAY,SAAZ,CAAP,EAA+BL,OAA/B;AACH;AACJ,CARD,EAQG,UAAUG,OAAV,EAAmBD,OAAnB,EAA4B;AAC3B;;AACAK,WAAOC,cAAP,CAAsBN,OAAtB,EAA+B,YAA/B,EAA6C,EAAEjC,OAAO,IAAT,EAA7C;AACA,QAAIwC,cAAc,aAAe,YAAY;AACzC,iBAASA,WAAT,CAAqBC,MAArB,EAA6BC,OAA7B,EAAsC;AAClC,iBAAKC,OAAL,GAAeF,OAAOG,kBAAP,EAAf;AACA,iBAAKC,MAAL,GAAcH,QAAQI,KAAtB;AACA,iBAAKC,SAAL,GAAiBL,QAAQM,QAAzB;AACH;AACDR,oBAAYS,SAAZ,CAAsBC,KAAtB,GAA8B,YAAY;AACtC,gBAAIC,QAAQ,IAAZ;AACA,mBAAO,IAAIvD,OAAJ,CAAY,UAAUC,OAAV,EAAmBC,MAAnB,EAA2B;AAAE,uBAAOP,UAAU4D,KAAV,EAAiB,KAAK,CAAtB,EAAyB,KAAK,CAA9B,EAAiC,YAAY;AAChG,wBAAIA,QAAQ,IAAZ;AACA,wBAAIC,WAAJ;AACA,2BAAO3C,YAAY,IAAZ,EAAkB,UAAU4C,EAAV,EAAc;AACnC,6BAAKC,IAAL;AACAC,gCAAQC,GAAR,CAAY,eAAZ;AACAJ,sCAAcK,YAAY,YAAY;AAAE,mCAAOlE,UAAU4D,KAAV,EAAiB,KAAK,CAAtB,EAAyB,KAAK,CAA9B,EAAiC,YAAY;AACxF,oCAAIO,KAAJ,EAAWC,QAAX,EAAqBC,OAArB;AACA,uCAAOnD,YAAY,IAAZ,EAAkB,UAAU4C,EAAV,EAAc;AACnC,4CAAQA,GAAGzC,KAAX;AACI,6CAAK,CAAL;AAAQ,mDAAO,CAAC,CAAD,CAAG,SAAH,EAAc,KAAKiD,QAAL,EAAd,CAAP;AACR,6CAAK,CAAL;AACIH,oDAAQL,GAAGxC,IAAH,EAAR;AACA,mDAAO,CAAC,CAAD,CAAG,SAAH,EAAc,KAAKiD,aAAL,CAAmB,IAAIC,UAAJ,CAAeL,KAAf,CAAnB,CAAd,CAAP;AACJ,6CAAK,CAAL;AACIC,uDAAWN,GAAGxC,IAAH,EAAX;AACA+C,sDAAU;AACNI,qDAAK,eADC;AAENC,wDAAQ;AACJP,2DAAOC;AADH;AAFF,6CAAV;AAMA,iDAAKO,OAAL,CAAaC,WAAb,CAAyBP,OAAzB,EAAkC,CAACA,QAAQK,MAAR,CAAeP,KAAhB,CAAlC;AACA,mDAAO,CAAC,CAAD,CAAG,UAAH,CAAP;AAdR;AAgBH,iCAjBM,CAAP;AAkBH,6BApB8C,CAAP;AAoBnC,yBApBS,EAoBP,KAAKb,MApBE,CAAd;AAqBAuB,mCAAW,YAAY;AACnBC,0CAAcjB,WAAd;AACA,gCAAIQ,UAAU;AACVI,qCAAK,WADK;AAEVC,wCAAQ,EAAEK,OAAOnB,MAAMoB,aAAN,CAAoBD,KAA7B,EAAoCE,QAAQrB,MAAMoB,aAAN,CAAoBC,MAAhE;AAFE,6BAAd;AAIArB,kCAAMe,OAAN,CAAcC,WAAd,CAA0BP,OAA1B;AACAT,kCAAMe,OAAN,CAAcO,SAAd,GAA0B,UAAUpB,EAAV,EAAc;AACpC,oCAAIqB,OAAOrB,GAAGqB,IAAd;AACAnB,wCAAQC,GAAR,CAAY,UAAZ,EAAwBkB,IAAxB;AACA7E,wCAAQ6E,IAAR;AACH,6BAJD;AAKH,yBAZD,EAYG,KAAK3B,SAZR;AAaA,+BAAO,CAAC,CAAD,CAAG,UAAH,CAAP;AACH,qBAtCM,CAAP;AAuCH,iBA1CsD,CAAP;AA0C3C,aA1CE,CAAP;AA2CH,SA7CD;AA8CAP,oBAAYS,SAAZ,CAAsB0B,IAAtB,GAA6B,YAAY,CAAG,CAA5C;AACAnC,oBAAYS,SAAZ,CAAsB2B,MAAtB,GAA+B,YAAY,CAAG,CAA9C;AACApC,oBAAYS,SAAZ,CAAsB4B,QAAtB,GAAiC,UAAUC,QAAV,EAAoB;AACjD,gBAAI3B,QAAQ,IAAZ;AACA,gBAAI2B,aAAa,KAAK,CAAtB,EAAyB;AAAEA,2BAAW,eAAX;AAA6B;AACxD,mBAAO,IAAIlF,OAAJ,CAAY,UAAUC,OAAV,EAAmBC,MAAnB,EAA2B;AAAE,uBAAOP,UAAU4D,KAAV,EAAiB,KAAK,CAAtB,EAAyB,KAAK,CAA9B,EAAiC,YAAY;AAChG,wBAAI4B,GAAJ,EAASC,GAAT,EAAcH,QAAd;AACA,2BAAOpE,YAAY,IAAZ,EAAkB,UAAU4C,EAAV,EAAc;AACnC,gCAAQA,GAAGzC,KAAX;AACI,iCAAK,CAAL;AAAQ,uCAAO,CAAC,CAAD,CAAG,SAAH,EAAc,KAAKsC,KAAL,EAAd,CAAP;AACR,iCAAK,CAAL;AACI6B,sCAAM1B,GAAGxC,IAAH,EAAN;AACAmE,sCAAMC,IAAIC,eAAJ,CAAoB,IAAIC,IAAJ,CAAS,CAAC,IAAIpB,UAAJ,CAAegB,GAAf,CAAD,CAAT,EAAgC;AACtDK,0CAAM;AADgD,iCAAhC,CAApB,CAAN;AAGAP,2CAAWQ,SAASC,aAAT,CAAuB,GAAvB,CAAX;AACAD,yCAAS3E,IAAT,CAAc6E,WAAd,CAA0BV,QAA1B;AACAA,yCAASW,MAAT,GAAkB,QAAlB;AACAX,yCAASY,KAAT,CAAeC,OAAf,GAAyB,MAAzB;AACAb,yCAASc,IAAT,GAAgBX,GAAhB;AACAH,yCAASA,QAAT,GAAoBC,QAApB;AACAD,yCAASe,KAAT;AACAf,yCAASgB,MAAT;AACA,qCAAK3B,OAAL,CAAa4B,SAAb;AACAjG;AACA,uCAAO,CAAC,CAAD,CAAG,UAAH,CAAP;AAjBR;AAmBH,qBApBM,CAAP;AAqBH,iBAvBsD,CAAP;AAuB3C,aAvBE,CAAP;AAwBH,SA3BD;AA4BA2C,oBAAYS,SAAZ,CAAsBY,QAAtB,GAAiC,YAAY;AACzC,gBAAIV,QAAQ,IAAZ;AACA,mBAAO,IAAIvD,OAAJ,CAAY,UAAUC,OAAV,EAAmBC,MAAnB,EAA2B;AAC1C,oBAAIiG,KAAK5C,MAAMR,OAAN,CAAcqD,UAAd,CAAyB,QAAzB,KAAsC7C,MAAMR,OAAN,CAAcqD,UAAd,CAAyB,OAAzB,CAA/C;AACA,oBAAIC,SAAS,IAAIlC,UAAJ,CAAegC,GAAGG,kBAAH,GAAwBH,GAAGI,mBAA3B,GAAiD,CAAhE,CAAb;AACAJ,mBAAGK,UAAH,CAAc,CAAd,EAAiB,CAAjB,EAAoBL,GAAGG,kBAAvB,EAA2CH,GAAGI,mBAA9C,EAAmEJ,GAAGM,IAAtE,EAA4EN,GAAGO,aAA/E,EAA8FL,MAA9F;AACApG,wBAAQoG,OAAOM,MAAf;AACH,aALM,CAAP;AAMH,SARD;AASA/D,oBAAYS,SAAZ,CAAsBK,IAAtB,GAA6B,YAAY;AACrC,iBAAKkD,MAAL,GAAc,KAAK7D,OAAL,CAAa2B,KAA3B;AACA,iBAAKmC,OAAL,GAAe,KAAK9D,OAAL,CAAa6B,MAA5B;AACA,iBAAKN,OAAL,GAAe,IAAIwC,MAAJ,CAAW,sCAAX,CAAf;AACA,iBAAKC,WAAL;AACH,SALD;AAMAnE,oBAAYS,SAAZ,CAAsB0D,WAAtB,GAAoC,YAAY;AAC5C,iBAAKC,cAAL,GAAsBvB,SAASC,aAAT,CAAuB,QAAvB,CAAtB;AACA,iBAAKuB,gBAAL,GAAwB,KAAKD,cAAL,CAAoBZ,UAApB,CAA+B,IAA/B,CAAxB;AACA,iBAAKY,cAAL,CAAoBtC,KAApB,GAA4B,KAAKkC,MAAjC;AACA,iBAAKI,cAAL,CAAoBpC,MAApB,GAA6B,KAAKiC,OAAlC;AACA,iBAAKlC,aAAL,GAAqBc,SAASC,aAAT,CAAuB,QAAvB,CAArB;AACA,iBAAKwB,eAAL,GAAuB,KAAKvC,aAAL,CAAmByB,UAAnB,CAA8B,IAA9B,CAAvB;AACH,SAPD;AAQAxD,oBAAYS,SAAZ,CAAsBa,aAAtB,GAAsC,UAAUJ,KAAV,EAAiB;AACnD,gBAAIP,QAAQ,IAAZ;AACA,mBAAO,IAAIvD,OAAJ,CAAY,UAAUC,OAAV,EAAmBC,MAAnB,EAA2B;AAC1C,oBAAIiH,YAAY5D,MAAM0D,gBAAN,CAAuBG,eAAvB,CAAuC7D,MAAMqD,MAA7C,EAAqDrD,MAAMsD,OAA3D,CAAhB;AACAM,0BAAUrC,IAAV,CAAeuC,GAAf,CAAmBvD,KAAnB;AACAP,sBAAM0D,gBAAN,CAAuBK,YAAvB,CAAoCH,SAApC,EAA+C,CAA/C,EAAkD,CAAlD;AACA5D,sBAAMgE,MAAN,CAAahE,MAAMoB,aAAnB;AACApB,sBAAMiE,IAAN,CAAWjE,MAAM2D,eAAjB,EAAkC3D,MAAMyD,cAAxC,EAAwDzD,MAAMoB,aAA9D;AACA,oBAAIG,OAAOvB,MAAM2D,eAAN,CAAsBO,YAAtB,CAAmC,CAAnC,EAAsC,CAAtC,EAAyClE,MAAMoB,aAAN,CAAoBD,KAA7D,EAAoEnB,MAAMoB,aAAN,CAAoBC,MAAxF,EAAgGE,IAA3G;AACA7E,wBAAQ6E,KAAK6B,MAAb;AACH,aARM,CAAP;AASH,SAXD;AAYA/D,oBAAYS,SAAZ,CAAsBkE,MAAtB,GAA+B,UAAUG,MAAV,EAAkB;AAC7C,gBAAInE,QAAQ,IAAZ;AACA,mBAAO,IAAIvD,OAAJ,CAAY,UAAUC,OAAV,EAAmB0H,KAAnB,EAA0B;AACzC,oBAAIC,WAAW,GAAf;AACA,oBAAIC,mBAAmBtE,MAAMqD,MAAN,GAAerD,MAAMsD,OAA5C;AACA,oBAAIgB,mBAAmB,CAAvB,EAA0B;AACtBH,2BAAOhD,KAAP,GAAekD,WAAWC,gBAA1B;AACAH,2BAAO9C,MAAP,GAAgBgD,QAAhB;AACH,iBAHD,MAIK,IAAIC,mBAAmB,CAAvB,EAA0B;AAC3BH,2BAAOhD,KAAP,GAAekD,QAAf;AACAF,2BAAO9C,MAAP,GAAgBgD,WAAWC,gBAA3B;AACH,iBAHI,MAIA;AACDH,2BAAOhD,KAAP,GAAekD,QAAf;AACAF,2BAAO9C,MAAP,GAAgBgD,QAAhB;AACH;AACDF,uBAAOhD,KAAP,GAAeoD,KAAKC,GAAL,CAASL,OAAOhD,KAAhB,EAAuB,CAAvB,CAAf;AACAgD,uBAAO9C,MAAP,GAAgBkD,KAAKC,GAAL,CAASL,OAAO9C,MAAhB,EAAwB,CAAxB,CAAhB;AACA3E;AACH,aAlBM,CAAP;AAmBH,SArBD;AAsBA2C,oBAAYS,SAAZ,CAAsBmE,IAAtB,GAA6B,UAAUQ,aAAV,EAAyBC,aAAzB,EAAwCC,YAAxC,EAAsD;AAC/E,gBAAI3E,QAAQ,IAAZ;AACA,mBAAO,IAAIvD,OAAJ,CAAY,UAAUC,OAAV,EAAmBC,MAAnB,EAA2B;AAC1C;AACA8H,8BAAcG,wBAAd,GAAyC,MAAzC;AACAH,8BAAcI,KAAd,CAAoB,CAApB,EAAuB,CAAC,CAAxB,EAH0C,CAGd;AAC5BJ,8BAAcK,SAAd,CAAwB,CAAxB,EAA2B,CAACH,aAAatD,MAAzC,EAJ0C,CAIQ;AAClDoD,8BAAcM,SAAd,CAAwBL,aAAxB,EAAuC,CAAvC,EAA0C,CAA1C,EAA6C1E,MAAMqD,MAAnD,EAA2DrD,MAAMsD,OAAjE,EAA0E,CAA1E,EAA6E,CAA7E,EAAgFqB,aAAaxD,KAA7F,EAAoGwD,aAAatD,MAAjH;AACAoD,8BAAcO,YAAd,CAA2B,CAA3B,EAA8B,CAA9B,EAAiC,CAAjC,EAAoC,CAApC,EAAuC,CAAvC,EAA0C,CAA1C;AACAP,8BAAcG,wBAAd,GAAyC,aAAzC;AACH,aARM,CAAP;AASH,SAXD;AAYA,eAAOvF,WAAP;AACH,KAxJgC,EAAjC;AAyJAP,YAAQmG,OAAR,GAAkB5F,WAAlB;AACH,CArKD","file":"game.0359e092.map","sourceRoot":"..","sourcesContent":["var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = y[op[0] & 2 ? \"return\" : op[0] ? \"throw\" : \"next\"]) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [0, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\n(function (factory) {\r\n    if (typeof module === \"object\" && typeof module.exports === \"object\") {\r\n        var v = factory(require, exports);\r\n        if (v !== undefined) module.exports = v;\r\n    }\r\n    else if (typeof define === \"function\" && define.amd) {\r\n        define([\"require\", \"exports\"], factory);\r\n    }\r\n})(function (require, exports) {\r\n    \"use strict\";\r\n    Object.defineProperty(exports, \"__esModule\", { value: true });\r\n    var GIFExporter = /** @class */ (function () {\r\n        function GIFExporter(engine, options) {\r\n            this._canvas = engine.getRenderingCanvas();\r\n            this._delay = options.delay;\r\n            this._duration = options.duration;\r\n        }\r\n        GIFExporter.prototype.start = function () {\r\n            var _this = this;\r\n            return new Promise(function (resolve, reject) { return __awaiter(_this, void 0, void 0, function () {\r\n                var _this = this;\r\n                var intervalRef;\r\n                return __generator(this, function (_a) {\r\n                    this.init();\r\n                    console.log('record canvas');\r\n                    intervalRef = setInterval(function () { return __awaiter(_this, void 0, void 0, function () {\r\n                        var frame, newFrame, message;\r\n                        return __generator(this, function (_a) {\r\n                            switch (_a.label) {\r\n                                case 0: return [4 /*yield*/, this.getFrame()];\r\n                                case 1:\r\n                                    frame = _a.sent();\r\n                                    return [4 /*yield*/, this.flipAndRotate(new Uint8Array(frame))];\r\n                                case 2:\r\n                                    newFrame = _a.sent();\r\n                                    message = {\r\n                                        job: 'collectFrames',\r\n                                        params: {\r\n                                            frame: newFrame,\r\n                                        },\r\n                                    };\r\n                                    this._worker.postMessage(message, [message.params.frame]);\r\n                                    return [2 /*return*/];\r\n                            }\r\n                        });\r\n                    }); }, this._delay);\r\n                    setTimeout(function () {\r\n                        clearInterval(intervalRef);\r\n                        var message = {\r\n                            job: 'createGIF',\r\n                            params: { width: _this._resizeCanvas.width, height: _this._resizeCanvas.height },\r\n                        };\r\n                        _this._worker.postMessage(message);\r\n                        _this._worker.onmessage = function (_a) {\r\n                            var data = _a.data;\r\n                            console.log('complete', data);\r\n                            resolve(data);\r\n                        };\r\n                    }, this._duration);\r\n                    return [2 /*return*/];\r\n                });\r\n            }); });\r\n        };\r\n        GIFExporter.prototype.stop = function () { };\r\n        GIFExporter.prototype.cancel = function () { };\r\n        GIFExporter.prototype.download = function (filename) {\r\n            var _this = this;\r\n            if (filename === void 0) { filename = 'canvasGIF.gif'; }\r\n            return new Promise(function (resolve, reject) { return __awaiter(_this, void 0, void 0, function () {\r\n                var gif, url, download;\r\n                return __generator(this, function (_a) {\r\n                    switch (_a.label) {\r\n                        case 0: return [4 /*yield*/, this.start()];\r\n                        case 1:\r\n                            gif = _a.sent();\r\n                            url = URL.createObjectURL(new Blob([new Uint8Array(gif)], {\r\n                                type: 'image/gif',\r\n                            }));\r\n                            download = document.createElement('a');\r\n                            document.body.appendChild(download);\r\n                            download.target = '_blank';\r\n                            download.style.display = 'none';\r\n                            download.href = url;\r\n                            download.download = filename;\r\n                            download.click();\r\n                            download.remove();\r\n                            this._worker.terminate();\r\n                            resolve();\r\n                            return [2 /*return*/];\r\n                    }\r\n                });\r\n            }); });\r\n        };\r\n        GIFExporter.prototype.getFrame = function () {\r\n            var _this = this;\r\n            return new Promise(function (resolve, reject) {\r\n                var gl = _this._canvas.getContext('webgl2') || _this._canvas.getContext('webgl');\r\n                var pixels = new Uint8Array(gl.drawingBufferWidth * gl.drawingBufferHeight * 4);\r\n                gl.readPixels(0, 0, gl.drawingBufferWidth, gl.drawingBufferHeight, gl.RGBA, gl.UNSIGNED_BYTE, pixels);\r\n                resolve(pixels.buffer);\r\n            });\r\n        };\r\n        GIFExporter.prototype.init = function () {\r\n            this._width = this._canvas.width;\r\n            this._height = this._canvas.height;\r\n            this._worker = new Worker('gif.creator.service.js');\r\n            this.canvasSetup();\r\n        };\r\n        GIFExporter.prototype.canvasSetup = function () {\r\n            this._holdingCanvas = document.createElement('canvas');\r\n            this._holdingCanvas2D = this._holdingCanvas.getContext('2d');\r\n            this._holdingCanvas.width = this._width;\r\n            this._holdingCanvas.height = this._height;\r\n            this._resizeCanvas = document.createElement('canvas');\r\n            this._resizeCanvas2D = this._resizeCanvas.getContext('2d');\r\n        };\r\n        GIFExporter.prototype.flipAndRotate = function (frame) {\r\n            var _this = this;\r\n            return new Promise(function (resolve, reject) {\r\n                var imageData = _this._holdingCanvas2D.createImageData(_this._width, _this._height);\r\n                imageData.data.set(frame);\r\n                _this._holdingCanvas2D.putImageData(imageData, 0, 0);\r\n                _this.resize(_this._resizeCanvas);\r\n                _this.flip(_this._resizeCanvas2D, _this._holdingCanvas, _this._resizeCanvas);\r\n                var data = _this._resizeCanvas2D.getImageData(0, 0, _this._resizeCanvas.width, _this._resizeCanvas.height).data;\r\n                resolve(data.buffer);\r\n            });\r\n        };\r\n        GIFExporter.prototype.resize = function (canvas) {\r\n            var _this = this;\r\n            return new Promise(function (resolve, rejct) {\r\n                var baseSize = 256;\r\n                var imageAspectRatio = _this._width / _this._height;\r\n                if (imageAspectRatio < 1) {\r\n                    canvas.width = baseSize * imageAspectRatio;\r\n                    canvas.height = baseSize;\r\n                }\r\n                else if (imageAspectRatio > 1) {\r\n                    canvas.width = baseSize;\r\n                    canvas.height = baseSize / imageAspectRatio;\r\n                }\r\n                else {\r\n                    canvas.width = baseSize;\r\n                    canvas.height = baseSize;\r\n                }\r\n                canvas.width = Math.max(canvas.width, 1);\r\n                canvas.height = Math.max(canvas.height, 1);\r\n                resolve();\r\n            });\r\n        };\r\n        GIFExporter.prototype.flip = function (resizeContext, holdingCanvas, resizeCanvas) {\r\n            var _this = this;\r\n            return new Promise(function (resolve, reject) {\r\n                // Scale and draw to flip Y to reorient readPixels.\r\n                resizeContext.globalCompositeOperation = 'copy';\r\n                resizeContext.scale(1, -1); // Y flip\r\n                resizeContext.translate(0, -resizeCanvas.height); // so we can draw at 0,0\r\n                resizeContext.drawImage(holdingCanvas, 0, 0, _this._width, _this._height, 0, 0, resizeCanvas.width, resizeCanvas.height);\r\n                resizeContext.setTransform(1, 0, 0, 1, 0, 0);\r\n                resizeContext.globalCompositeOperation = 'source-over';\r\n            });\r\n        };\r\n        return GIFExporter;\r\n    }());\r\n    exports.default = GIFExporter;\r\n});\r\n","import GIFExporter from 'babylonjs-gifexporter';\n\nconst captureBtn = document.getElementById('captureBtn');\n\nBabylonViewer.viewerManager.onViewerAddedObservable.add(function (viewer) {\n\n    viewer.onEngineInitObservable.add(function (engine) {\n\n        const recorder = new GIFExporter(engine, {\n            delay: 50,\n            duration: 4000\n        });\n\n        captureBtn.addEventListener('click', function () {\n            captureBtn.disabled = true;\n            recorder.download('babylonjs.gif');\n            captureBtn.disabled = false;\n\n        })\n    });\n\n});"]}